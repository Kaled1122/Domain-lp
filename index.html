<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BAE Training Suite 2025</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<style>
body{font-family:"Inter",sans-serif;background:#f5f6f7;color:#1f2937}
nav button{padding:10px 24px;border-radius:6px;margin:0 4px;font-weight:500;background:#f3f4f6;border:1px solid #e5e7eb;transition:.2s}
nav button:hover{background:#e5e7eb}
.active{background:#1e3a8a!important;color:#fff!important;border-color:#1e3a8a}
.card{background:#fff;border-radius:.75rem;box-shadow:0 2px 12px rgba(0,0,0,.06);padding:2rem;margin-bottom:2rem}
</style>
</head>
<body class="p-6">
<header class="text-center mb-8">
<h1 class="text-3xl font-extrabold text-indigo-900">BAE Systems — Training Suite 2025</h1>
<p class="text-gray-600 mt-1">Lesson Planning • Performance Register • Dashboard Analytics</p>
</header>

<nav class="flex justify-center mb-8 border-b pb-3">
<button id="btn-lesson" onclick="showTab('lesson')" class="active">Lesson Plan</button>
<button id="btn-register" onclick="showTab('register')">Performance Register</button>
<button id="btn-dashboard" onclick="showTab('dashboard')">Dashboard</button>
</nav>

<!-- LESSON PLAN -->
<section id="lesson" class="card">
<h2 class="text-xl font-semibold text-indigo-800 mb-4">Lesson Plan Generator</h2>
<form id="lessonForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
<input type="text" name="teacher" placeholder="Teacher Name" required>
<input type="text" name="lesson_title" placeholder="Lesson Title" required>
<input type="text" name="duration" placeholder="Duration (e.g. 45 minutes)">
<input type="text" name="cefr" placeholder="CEFR Level">
<input type="text" name="profile" placeholder="Learner Profile">
<input type="file" name="file" accept=".pdf,.txt" class="col-span-2 border p-2 bg-gray-50">
<button type="submit" class="col-span-2 btn-primary py-2 rounded-md bg-indigo-700 text-white font-semibold hover:bg-indigo-800">
Generate Lesson Plan
</button>
</form>
<iframe id="lessonOutput" class="w-full h-[550px] border rounded-md"></iframe>
<div class="mt-4 text-right">
<button id="downloadLesson" class="px-5 py-2 rounded-md bg-green-700 text-white hover:bg-green-800">Download Lesson (PDF)</button>
</div>
</section>

<!-- REGISTER -->
<section id="register" class="card hidden">
<div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-semibold text-indigo-800">Performance Register</h2>
<div class="flex gap-3 items-center">
<input type="number" id="numLearners" min="1" max="50" value="16" class="border px-3 py-1 w-24 text-center">
<button onclick="buildTable()" class="bg-indigo-700 text-white px-4 py-2 rounded-md">Create</button>
<button onclick="saveData()" class="bg-green-700 text-white px-4 py-2 rounded-md">Save</button>
</div>
</div>
<div class="overflow-x-auto">
<table id="regTable" class="w-full">
<thead><tr><th>Learner ID</th><th>U</th><th>A</th><th>C</th><th>B</th><th>Total</th></tr></thead>
<tbody></tbody>
</table>
</div>
</section>

<!-- DASHBOARD -->
<section id="dashboard" class="card hidden">
<div class="flex justify-between items-center mb-4 flex-wrap gap-3">
<h2 class="text-xl font-semibold text-indigo-800">Performance Dashboard</h2>
<div class="flex gap-2 flex-wrap items-center">
<input id="filterLearner" type="text" placeholder="Learner ID" class="border px-2 py-1">
<input id="fromDate" type="date" class="border px-2 py-1">
<input id="toDate" type="date" class="border px-2 py-1">
<button onclick="applyFilters()" class="bg-indigo-700 text-white px-3 py-1 rounded">Filter</button>
<button onclick="resetFilters()" class="bg-gray-400 text-white px-3 py-1 rounded">Clear</button>
<button onclick="loadDashboard()" class="bg-indigo-800 text-white px-3 py-1 rounded">Refresh</button>
<button onclick="downloadExcel('dataTable')" class="bg-green-700 text-white px-3 py-1 rounded">Excel</button>
<button onclick="downloadPDF()" class="bg-red-700 text-white px-3 py-1 rounded">PDF</button>
</div>
</div>

<div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4" id="summaryCards"></div>
<canvas id="avgChart" height="120"></canvas>

<div class="overflow-x-auto mt-6">
<table id="dataTable" class="w-full">
<thead><tr><th>Learner</th><th>U</th><th>A</th><th>C</th><th>B</th><th>Total</th><th>Date</th></tr></thead>
<tbody></tbody>
</table>
</div>
</section>

<footer class="text-center text-gray-500 mt-6 text-sm">
© 2025 BAE Systems Saudi Development & Training — Internal Use Only
</footer>

<script>
const backend="https://domain-lp-production.up.railway.app";

function showTab(t){["lesson","register","dashboard"].forEach(x=>{
document.getElementById(x).classList.add("hidden");
document.getElementById("btn-"+x).classList.remove("active");
});
document.getElementById(t).classList.remove("hidden");
document.getElementById("btn-"+t).classList.add("active");
}

document.getElementById("lessonForm").onsubmit=async e=>{
e.preventDefault();
Swal.fire({
title:"Generating Lesson Plan...",
html:"This may take 20–40 seconds. Please wait.",
allowOutsideClick:false,
didOpen:()=>Swal.showLoading()
});
const fd=new FormData(e.target);
try{
const res=await fetch(`${backend}/generate_lesson`,{method:"POST",body:fd});
if(!res.ok)throw new Error("Server Error: "+res.status);
const html=await res.text();
document.getElementById("lessonOutput").srcdoc=html;
Swal.close();
}catch(err){
Swal.fire("Error","Failed to generate lesson plan. Check backend.","error");
console.error(err);
}
};
document.getElementById("downloadLesson").onclick=()=>{
const el=document.getElementById("lessonOutput");
html2pdf().from(el.contentDocument.body).set({filename:"lesson.pdf"}).save();
};
</script>
</body>
</html>
